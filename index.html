<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机数生成器</title>
    <!-- 引入 Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            padding: 30px;
        }
        .hidden-menu {
            display: none;
        }
    </style>
</head>
<body class="grey lighten-4">

<div class="container white z-depth-2">
    <h4 class="center-align">随机数生成器</h4>
    <div class="row">
        <div class="input-field col s12">
            <input id="min" type="number">
            <label for="min">最小值</label>
        </div>
        <div class="input-field col s12">
            <input id="max" type="number">
            <label for="max">最大值</label>
        </div>
        <div class="input-field col s12">
            <input id="count" type="number">
            <label for="count">生成数量</label>
        </div>
        <div class="col s12 center-align">
            <button class="btn waves-effect waves-light blue" onclick="generateRandomNumbers()">生成随机数</button>
        </div>
    </div>
    <div class="result center-align" id="result" style="margin-top: 20px;"></div>
</div>

<!-- 隐藏的菜单按钮 -->
<div class="fixed-action-btn hidden-menu">
    <a class="btn-floating btn-large green">
        <i class="material-icons">settings</i>
    </a>
</div>

<!-- 设置弹窗 -->
<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h4>优化设置</h4>
        <div class="input-field">
            <input id="optimizationList" type="text">
            <label for="optimizationList">优化数字（用逗号分隔）</label>
        </div>
        <div class="input-field">
            <input id="generationLimit" type="number" value="10" disabled>
            <label for="generationLimit">生成次数取消优化（固定 10）</label>
        </div>
        <div class="input-field">
            <input id="optimizationThreshold" type="number" value="30" disabled>
            <label for="optimizationThreshold">优化比例取消阈值（固定 30%）</label>
        </div>
        <div class="center-align">
            <button class="btn blue" onclick="saveSettings()">保存设置</button>
        </div>
    </div>
</div>

<!-- 遮罩 -->
<div class="overlay" id="overlay"></div>

<!-- 引入 Materialize JS 和依赖 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
    let clickCount = 0;
    const settingsModal = document.getElementById('settingsModal');
    const hiddenMenu = document.querySelector('.hidden-menu');
    const modalInstance = M.Modal.init(settingsModal, { dismissible: false });

    const defaultSettings = {
        optimizationNumbers: [],
        maxGenerations: 10,
        optimizationThreshold: 30,
        lastInputs: { min: '', max: '', count: '' }
    };

    // 获取设置
    function getSettings() {
        const cookie = document.cookie.split('; ').find(row => row.startsWith('settings='));
        return cookie ? JSON.parse(decodeURIComponent(cookie.split('=')[1])) : { ...defaultSettings };
    }

    // 保存设置
    function saveSettings(settings = {}) {
        const mergedSettings = { ...getSettings(), ...settings };
        document.cookie = `settings=${encodeURIComponent(JSON.stringify(mergedSettings))}; path=/;`;
    }

    function generateRandomNumbers() {
        const min = parseInt(document.getElementById('min').value);
        const max = parseInt(document.getElementById('max').value);
        const count = parseInt(document.getElementById('count').value);

        if (isNaN(min) || isNaN(max) || isNaN(count) || min >= max || count <= 0) {
            M.toast({ html: '请输入有效的数值', classes: 'red' });
            return;
        }

        const settings = getSettings();
        settings.lastInputs = { min, max, count };
        saveSettings(settings);

        const blockedNumbers = settings.optimizationNumbers;
        const validNumbersCount = (max - min + 1) - blockedNumbers.filter(num => num >= min && num <= max).length;

        if (count > validNumbersCount) {
            document.getElementById('result').innerText = '数量超过可用范围';
            return;
        }

        const result = [];
        while (result.length < count) {
            const randomNum = Math.floor(Math.random() * (max - min + 1)) + min;
            if (!blockedNumbers.includes(randomNum) && !result.includes(randomNum)) {
                result.push(randomNum);
            }
        }

        document.getElementById('result').innerText = '生成的随机数: ' + result.join(', ');
    }

    document.addEventListener('DOMContentLoaded', () => {
        // 点击标题 15 次显示隐藏按钮
        document.querySelector('h4').addEventListener('click', () => {
            clickCount++;
            if (clickCount === 15) {
                hiddenMenu.style.display = 'block';
            }
        });

        const settings = getSettings();
        document.getElementById('min').value = settings.lastInputs.min || '';
        document.getElementById('max').value = settings.lastInputs.max || '';
        document.getElementById('count').value = settings.lastInputs.count || '';
    });
</script>
</body>
</html>
